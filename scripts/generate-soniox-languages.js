#!/usr/bin/env node
/**
 * Generate Soniox language constants from OpenAPI spec
 *
 * This script extracts language codes from the GetModelsResponse example
 * in the Soniox OpenAPI spec and generates TypeScript constants.
 *
 * Run: node scripts/generate-soniox-languages.js
 */

const fs = require("fs")
const path = require("path")

const SPEC_PATH = path.join(__dirname, "../specs/soniox-openapi.json")
const OUTPUT_PATH = path.join(__dirname, "../src/generated/soniox/languages.ts")

function main() {
  console.log("ðŸ“¦ Generating Soniox language constants from OpenAPI spec...")

  // Read the OpenAPI spec
  if (!fs.existsSync(SPEC_PATH)) {
    console.error(`âŒ OpenAPI spec not found: ${SPEC_PATH}`)
    console.error("   Run 'pnpm openapi:sync:soniox' first to download the spec.")
    process.exit(1)
  }

  const spec = JSON.parse(fs.readFileSync(SPEC_PATH, "utf-8"))

  // Extract languages from GetModelsResponse example
  const getModelsResponse = spec.components?.schemas?.GetModelsResponse
  if (!getModelsResponse?.example?.models) {
    console.error("âŒ Could not find GetModelsResponse.example.models in spec")
    process.exit(1)
  }

  // Get the first model's languages (they're all the same across models)
  const firstModel = getModelsResponse.example.models[0]
  if (!firstModel?.languages) {
    console.error("âŒ Could not find languages in model example")
    process.exit(1)
  }

  const languages = firstModel.languages
  console.log(`   Found ${languages.length} languages in spec`)

  // Generate TypeScript file
  const output = `/**
 * Generated from Soniox OpenAPI spec - DO NOT EDIT MANUALLY
 *
 * This file is auto-generated by scripts/generate-soniox-languages.js
 * Run 'pnpm openapi:sync-soniox-languages' to regenerate.
 *
 * @generated
 */

/**
 * Soniox supported language metadata
 * Derived from GetModelsResponse in OpenAPI spec
 */
export const SonioxLanguages = [
${languages.map((lang) => `  { code: "${lang.code}", name: "${lang.name}" }`).join(",\n")}
] as const

/**
 * Soniox supported language codes
 * ISO 639-1 two-letter codes
 */
export const SonioxLanguageCodes = [
${languages.map((lang) => `  "${lang.code}"`).join(",\n")}
] as const

/**
 * Type for Soniox language codes
 */
export type SonioxLanguageCode = (typeof SonioxLanguageCodes)[number]

/**
 * Language code to name mapping
 */
export const SonioxLanguageLabels: Record<SonioxLanguageCode, string> = {
${languages.map((lang) => `  ${lang.code}: "${lang.name}"`).join(",\n")}
} as const
`

  // Ensure output directory exists
  const outputDir = path.dirname(OUTPUT_PATH)
  if (!fs.existsSync(outputDir)) {
    fs.mkdirSync(outputDir, { recursive: true })
  }

  fs.writeFileSync(OUTPUT_PATH, output, "utf-8")
  console.log(`âœ… Generated ${OUTPUT_PATH}`)
  console.log(`   - ${languages.length} language codes`)
  console.log(`   - SonioxLanguages, SonioxLanguageCodes, SonioxLanguageCode, SonioxLanguageLabels`)
}

main()
